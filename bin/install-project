#!/usr/bin/env bash

### Functions ###

# Output help to console.
show_help() {
    cat << EOF
Usage:   ${0##*/} [-h|--help] [DISTRIBUTION]
Install DISTRIBUTION (drupal core by default) for testing.

Parameter:
    DISTRIBUTION                The distribution to test the module in.
                                Possible values: drupal, thunder
Options:
    -h,  --help                 display this help.

EOF

    exit 1
}

# Get exact location of script.
get_script_dir() {
    local dir
    local source="${BASH_SOURCE[0]}"

    # resolve $source until the file is no longer a symlink
    while [ -h "$source" ]; do
        dir="$( cd -P "$( dirname "$source" )" && pwd )"
        source="$(readlink "$source")"

        # if $source was a relative symlink, we need to resolve it relative to the path where the symlink file was located
        [[ $source != /* ]] && source="$dir/$source"
    done
    echo "$( cd -P "$( dirname "$source" )" && pwd )"
}


### Parse command arguments ###

for i in "${@}"; do
    case ${i} in
        -h | -\? | --help)
            show_help
        ;;
        -?*)
            echo "WARN: Unknown option (ignored): ${i}\n"
            show_help
        ;;
        *)
        # last option has to be the system to test in
            DISTRIBUTION=${i}
            break
    esac
done

### Fallback values ###

DISTRIBUTION=${DISTRIBUTION:-drupal}

### Source required files ###

source $(get_script_dir)/../lib/environment.sh
source $(get_script_dir)/../lib/testing-library.sh

### Script ###

install_project
